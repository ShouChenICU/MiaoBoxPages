import{g as V}from"./app-Cg3FD67L.js";function G(l,d){for(var h=0;h<d.length;h++){const c=d[h];if(typeof c!="string"&&!Array.isArray(c)){for(const r in c)if(r!=="default"&&!(r in l)){const p=Object.getOwnPropertyDescriptor(c,r);p&&Object.defineProperty(l,r,p.get?p:{enumerable:!0,get:()=>c[r]})}}}return Object.freeze(Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}))}var T={exports:{}},M={exports:{}};/*! For license information please see jsstore.commonjs2.min.js.LICENSE.txt */(()=>{var l={d:(e,t)=>{for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},d={};l.r(d),l.d(d,{API:()=>r,CONNECTION_STATUS:()=>w,Connection:()=>P,DATA_TYPE:()=>c,ERROR_TYPE:()=>I,EVENT:()=>p,IDB_MODE:()=>x,OCCURENCE:()=>O,QUERY_OPTION:()=>D,WORKER_STATUS:()=>h,forObj:()=>U,promise:()=>C,promiseAll:()=>R,promiseResolve:()=>v});var h,c,r,p,D,x,O,w,S=function(){function e(t,n){this.type=t,this._info=n,this.message=this.getMsg()}return e.prototype.throw=function(){throw this},e.prototype.log=function(t){this.status&&console.log(t)},e.prototype.logError=function(){console.error(this.get())},e.prototype.logWarning=function(){console.warn(this.get())},e.prototype.get=function(){return{message:this.message,type:this.type}},e.prototype.getMsg=function(){return this.type,this.message},e}(),I={InvalidUpdateColumn:"invalid_update_column",UndefinedColumn:"undefined_column",UndefinedValue:"undefined_value",UndefinedColumnName:"undefined_column_name",UndefinedDbName:"undefined_database_name",UndefinedColumnValue:"undefined_column_value",NotArray:"not_array",NoValueSupplied:"no_value_supplied",ColumnNotExist:"column_not_exist",NoIndexFound:"no_index_found",InvalidOp:"invalid_operator",NullValue:"null_value",WrongDataType:"wrong_data_type",TableNotExist:"table_not_exist",DbNotExist:"db_not_exist",ConnectionAborted:"connection_aborted",ConnectionClosed:"connection_closed",NotObject:"not_object",InvalidConfig:"invalid_config",DbBlocked:"Db_blocked",IndexedDbNotSupported:"indexeddb_not_supported",NullValueInWhere:"null_value_in_where",InvalidJoinQuery:"invalid_join_query",InvalidQuery:"invalid_query",ImportScriptsFailed:"import_scripts_failed",MethodNotExist:"method_not_exist",Unknown:"unknown",InvalidMiddleware:"invalid_middleware"};(function(e){e.Registered="registerd",e.Failed="failed",e.NotStarted="not_started"})(h||(h={})),function(e){e.String="string",e.Object="object",e.Array="array",e.Number="number",e.Boolean="boolean",e.Null="null",e.DateTime="date_time"}(c||(c={})),function(e){e.InitDb="init_db",e.MapGet="map_get",e.MapSet="map_set",e.MapHas="map_has",e.MapDelete="map_delete",e.Select="select",e.Insert="insert",e.Update="update",e.Remove="remove",e.OpenDb="open_db",e.Clear="clear",e.DropDb="drop_db",e.Count="count",e.ChangeLogStatus="change_log_status",e.Terminate="terminate",e.Transaction="transaction",e.CloseDb="close_db",e.Union="union",e.Intersect="intersect",e.ImportScripts="import_scripts",e.Middleware="middleware"}(r||(r={})),function(e){e.RequestQueueEmpty="requestQueueEmpty",e.RequestQueueFilled="requestQueueFilled",e.Upgrade="upgrade",e.Create="create",e.Open="open"}(p||(p={})),function(e){e.Where="where",e.Like="like",e.Regex="regex",e.In="in",e.Equal="=",e.Between="-",e.GreaterThan=">",e.LessThan="<",e.GreaterThanEqualTo=">=",e.LessThanEqualTo="<=",e.NotEqualTo="!=",e.Aggregate="aggregate",e.Max="max",e.Min="min",e.Avg="avg",e.Count="count",e.Sum="sum",e.List="list",e.Or="or",e.Skip="skip",e.Limit="limit",e.And="and",e.IgnoreCase="ignoreCase",e.Then="then"}(D||(D={})),function(e){e.ReadOnly="readonly",e.ReadWrite="readwrite"}(x||(x={})),function(e){e.First="f",e.Last="l",e.Any="a"}(O||(O={})),function(e){e.Connected="connected",e.Closed="closed",e.NotStarted="not_started",e.UnableToStart="unable_to_start",e.ClosedByJsStore="closed_by_jsstore"}(w||(w={}));var b,C=function(e){return new Promise(e)},v=function(e){return Promise.resolve(e)},Q=function(){function e(t){this._events={},this._ctx=t}return e.prototype.on=function(t,n){return this._events[t]==null&&(this._events[t]=[]),this._events[t].push(n),this},e.prototype.off=function(t,n){if(this._events[t])if(n){var o=this._events[t].indexOf(n);this._events[t].splice(o,1)}else this._events[t]=[]},e.prototype.emit=function(t){for(var n=this,o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];var a=this._events[t]||[],u=0,s=a.length,_=[];return new Promise(function(W){var A=function(){u<s?function(){var m=a[u++];if(m){var q=m.call.apply(m,function(B,y,F){if(F||arguments.length===2)for(var g,f=0,L=y.length;f<L;f++)!g&&f in y||(g||(g=Array.prototype.slice.call(y,0,f)),g[f]=y[f]);return B.concat(g||Array.prototype.slice.call(y))}([n._ctx],o,!1));return q&&q.then?q:Promise.resolve(q)}}().then(function(m){_.push(m),A()}):W(_)};A()})},e.prototype.destroy=function(){this._events=null,this._ctx=null},e}(),k=function(){function e(t){this.isConOpened_=!1,this.isDbIdle_=!0,this.requestQueue_=[],this.isCodeExecuting_=!1,this.inactivityTimer_=-1e3,this.middlewares=[],this.eventBus_=new Q(this),this.whiteListApi_=[r.InitDb,r.OpenDb,r.MapGet,r.MapSet,r.MapHas,r.MapDelete,r.ChangeLogStatus,r.Terminate,r.DropDb],this.isWorker=!0,this.logger=new S(null),t?(this.worker_=t,this.worker_.onmessage=this.onMessageFromWorker_.bind(this)):(this.isWorker=!1,this.initQueryManager_())}return Object.defineProperty(e.prototype,"jsstoreWorker",{get:function(){return this.$worker||self.JsStoreWorker},enumerable:!1,configurable:!0}),e.prototype.initQueryManager_=function(){var t=this.jsstoreWorker;t&&(this.queryManager=new t.QueryManager(this.processFinishedQuery_.bind(this)))},e.prototype.onMessageFromWorker_=function(t){this.processFinishedQuery_(t.data)},e.prototype.processFinishedQuery_=function(t){var n=this.requestQueue_.shift();if(n){if(this.logger.log("request ".concat(n.name," finished")),t.error)n.onError(t.error);else{switch(n.name){case r.OpenDb:case r.InitDb:this.isConOpened_=!0;break;case r.Terminate:this.isConOpened_=!1,this.isWorker===!0&&this.worker_.terminate();case r.DropDb:this.isConOpened_=!1,this.requestQueue_=[],this.isDbIdle_=!0;break;case r.CloseDb:this.isDbIdle_=!0,this.eventBus_.emit(p.RequestQueueEmpty,[]),this.requestQueue_.length>0&&this.openDb_(!1)}n.onSuccess(t.result)}this.isCodeExecuting_=!1,this.executeQry_()}},e.prototype.openDb_=function(t){t===void 0&&(t=!0);var n={name:r.OpenDb,query:{name:this.database.name,version:this.database.version},onSuccess:function(){},onError:function(o){console.error(o)}};t?this.prcoessExecutionOfQry_(n,0):this.requestQueue_.splice(0,0,n)},e.prototype.executeMiddleware_=function(t){var n=this;return C(function(o){var i=0,a=n.middlewares.length-1,u=function(){if(i<=a){var s=n.middlewares[i++](t);s&&s.then||(s=v(s)),s.then(function(_){u()})}else o()};u()})},e.prototype.callResultMiddleware=function(t,n){return C(function(o){var i=0,a=t.length-1,u=function(){if(i<=a){var s=t[i++](n);s.then||(s=v(s)),s.then(function(_){n=_,u()})}else o(n)};u()})},e.prototype.pushApi=function(t){var n=this;return new Promise(function(o,i){var a=[];t.onResult=function(u){a.push(function(s){return u(s)})},n.executeMiddleware_(t).then(function(){t.onSuccess=function(u){n.callResultMiddleware(a,u).then(function(s){o(s)}).catch(function(s){t.onError(s)})},t.onError=function(u){a=[],i(u)},n.requestQueue_.length===0&&(n.eventBus_.emit(p.RequestQueueFilled,[]),n.isDbIdle_&&n.isConOpened_&&([r.InitDb,r.CloseDb,r.DropDb,r.OpenDb,r.Terminate].indexOf(t.name)>=0||n.openDb_()),clearTimeout(n.inactivityTimer_)),n.prcoessExecutionOfQry_(t)}).catch(i)})},e.prototype.prcoessExecutionOfQry_=function(t,n){this.isDbIdle_=!1,n!=null?this.requestQueue_.splice(n,0,t):this.requestQueue_.push(t),this.logger.log("request pushed: "+t.name),this.executeQry_()},e.prototype.executeQry_=function(){var t=this,n=this.requestQueue_.length;if(!this.isCodeExecuting_&&n>0){if(this.isConOpened_===!0)return void this.sendRequestToWorker_(this.requestQueue_[0]);var o=this.requestQueue_.findIndex(function(i){return t.whiteListApi_.indexOf(i.name)>=0});o>=0&&(this.requestQueue_.splice(0,0,this.requestQueue_.splice(o,1)[0]),this.sendRequestToWorker_(this.requestQueue_[0]))}else n===0&&this.isDbIdle_===!1&&this.isConOpened_&&(this.inactivityTimer_=setTimeout(function(){t.prcoessExecutionOfQry_({name:r.CloseDb,onSuccess:function(){},onError:function(i){console.error(i)}})},100))},e.prototype.sendRequestToWorker_=function(t){this.isCodeExecuting_=!0,this.logger.log("request executing: "+t.name);var n={name:t.name,query:t.query};this.isWorker===!0?this.worker_.postMessage(n):this.queryManager.run(n)},e}(),j=function(){function e(t){this.con=t}return e.prototype.get=function(t){return this.con.pushApi({name:r.MapGet,query:t})},e.prototype.has=function(t){return this.con.pushApi({name:r.MapHas,query:t})},e.prototype.set=function(t,n){return this.con.pushApi({name:r.MapSet,query:{key:t,value:n}})},e.prototype.delete=function(t){return this.con.pushApi({name:r.MapDelete,query:t})},e}(),N=(b=function(e,t){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},b(e,t)},function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}b(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}),P=function(e){function t(n){var o=e.call(this,n)||this;return o.Map=new j(o),o}return N(t,e),t.prototype.initDb=function(n){var o=this;return this.database=n,this.pushApi({name:r.InitDb,query:n}).then(function(i){var a,u=i.database;return i.isCreated&&(a=i.oldVersion?o.eventBus_.emit(p.Upgrade,u,i.oldVersion,i.newVersion):o.eventBus_.emit(p.Create,u)),(a||v()).then(function(s){return o.eventBus_.emit(p.Open,u)}).then(function(s){return i.isCreated})})},t.prototype.dropDb=function(){return this.pushApi({name:r.DropDb})},t.prototype.select=function(n){return this.pushApi({name:r.Select,query:n})},t.prototype.count=function(n){return this.pushApi({name:r.Count,query:n})},t.prototype.insert=function(n){return this.pushApi({name:r.Insert,query:n})},t.prototype.update=function(n){return this.pushApi({name:r.Update,query:n})},t.prototype.remove=function(n){return this.pushApi({name:r.Remove,query:n})},t.prototype.clear=function(n){return this.pushApi({name:r.Clear,query:n})},Object.defineProperty(t.prototype,"logStatus",{set:function(n){this.logger.status=n,this.pushApi({name:r.ChangeLogStatus,query:n})},enumerable:!1,configurable:!0}),t.prototype.openDb=function(n,o){var i=this;return this.pushApi({name:r.OpenDb,query:{version:o,name:n}}).then(function(a){return i.database=a,a})},t.prototype.getDbList=function(){return console.warn("Api getDbList is recommended to use for debugging only. Do not use in code."),indexedDB.databases()},t.prototype.get=function(n){return console.warn("This API is obsolete, please use Map"),this.Map.get(n)},t.prototype.set=function(n,o){return console.warn("This API is obsolete, please use Map"),this.Map.set(n,o)},t.prototype.terminate=function(){return this.pushApi({name:r.Terminate})},t.prototype.transaction=function(n){return this.pushApi({name:r.Transaction,query:n})},t.prototype.on=function(n,o){this.eventBus_.on(n,o)},t.prototype.off=function(n,o){this.eventBus_.off(n,o)},t.prototype.union=function(n){return this.pushApi({name:r.Union,query:n})},t.prototype.intersect=function(n){return this.pushApi({name:r.Intersect,query:n})},t.prototype.addPlugin=function(n,o){return n.setup(this,o)},t.prototype.addMiddleware=function(n,o){return o?this.pushApi({name:r.Middleware,query:n}):(this.middlewares.push(n),Promise.resolve())},t.prototype.importScripts=function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return this.pushApi({name:r.ImportScripts,query:n})},t}(k),R=function(e){return Promise.all(e)},U=function(e,t){for(var n in e)t(n,e[n])};M.exports=d})();var H=M.exports;T.exports=H;var E=T.exports;const J=V(E),$=G({__proto__:null,default:J},[E]);export{$ as n};
